<?phpclass Goal_model extends CI_Model{	function __construct()	{		parent::__construct();		$this->load->database();		$this->config->load('dbtables', TRUE);			}		function getGoals()	{		$goalsQuery = $this->db->get($this->config->item('ala_goals','dbtables'));		return $goalsQuery->result();	}		function insertStaff()	{		$checkStaff = $this->db->get_where($this->config->item('ala_goals','dbtables'),array("email"=>trim($this->input->post("email"))));		if($checkStaff->row())		{			return "exist";		}		else		{			$insertArr = array(								'createdAt' => date("Y-m-d H:i:s"),								'updatedAt' => date("Y-m-d H:i:s"),								'panchayatId' => trim($this->session->userdata("info_user_id")),								'name' => trim($this->input->post("name")),								'designation' => trim($this->input->post("designation")),								'birthdate' => date("Y-m-d",strtotime(trim($this->input->post("birthdate")))),								'email' => trim($this->input->post("email")),								'phone' => trim($this->input->post("phone")),								'address' => trim($this->input->post("address")),								'biodata' => trim($this->input->post("biodata")),								'workInfo' => trim($this->input->post("workInfo")),								'photo' => (($this->input->post("staff_hidden") && trim($this->input->post("staff_hidden"))!="")?trim($this->input->post("staff_hidden")):""),							  );			$result = $this->db->insert($this->config->item('ala_goals','dbtables'), $insertArr);			$staffId =  $this->db->insert_id();			if($staffId>0)			{				$staffImg = (($this->input->post("staff_hidden") && trim($this->input->post("staff_hidden"))!="")?trim($this->input->post("staff_hidden")):"");				$staffImgArr = ((trim($staffImg)!="")?explode("|",$staffImg):array());								if(count($staffImgArr)>0)				{					foreach($staffImgArr as $singleStaffImg)					{						if(trim($singleStaffImg)!="")						{							if(!file_exists($this->config->item("staffImagePath")."/".$singleStaffImg))							{								rename($this->config->item("staffImageTempPath")."/".$singleStaffImg,$this->config->item("staffImagePath")."/".$singleStaffImg);							}						}					}				}			}			return $staffId;		}	}		function getStaffData($staffId)	{		$getStaffQuery = $this->db->get_where($this->config->item('ala_goals','dbtables'),array("id"=>trim($staffId)));		$staffData = $getStaffQuery->row();		return $staffData;	}	function updateStaff($staffId)	{		$checkStaffQuery = $this->db->get_where($this->config->item('ala_goals','dbtables'),array("email"=>trim($this->input->post("email"))));		$checkStaff = $checkStaffQuery->row();				if($checkStaff && $checkStaff->id!=$staffId)		{			return "exist";		}		else		{			$data = array(							'updatedAt' => date("Y-m-d H:i:s"),							'name' => trim($this->input->post("name")),							'designation' => trim($this->input->post("designation")),							'birthdate' => date("Y-m-d",strtotime(trim($this->input->post("birthdate")))),							'email' => trim($this->input->post("email")),							'phone' => trim($this->input->post("phone")),							'address' => trim($this->input->post("address")),							'biodata' => trim($this->input->post("biodata")),							'workInfo' => trim($this->input->post("workInfo")),						);			$this->db->where('id',$staffId);			$res = $this->db->update($this->config->item('ala_goals','dbtables'), $data);						$staffImg = (($this->input->post("staff_hidden") && trim($this->input->post("staff_hidden"))!="")?trim($this->input->post("staff_hidden")):"");			$staffImg_original = (($this->input->post("staff_hidden_original") && trim($this->input->post("staff_hidden_original"))!="")?trim($this->input->post("staff_hidden_original")):"");						$staffImgArr = ((trim($staffImg)!="")?explode("|",$staffImg):array());			$staffImgArr_original = ((trim($staffImg_original)!="")?explode("|",$staffImg_original):array());			$staffImgArr_deleted = array_diff($staffImgArr_original, $staffImgArr);			$staffImgArr_update = array_diff($staffImgArr, $staffImgArr_original);			if(count($staffImgArr_deleted)>0)			{				foreach($staffImgArr_deleted as $singleStaffImg)				{					if(trim($singleStaffImg)!="")					{						@unlink($this->config->item("staffImagePath")."/".$singleStaffImg);					}				}			}			if(count($staffImgArr_update)>0)			{				foreach($staffImgArr_update as $singleStaffImg)				{					if(!file_exists($this->config->item("staffImagePath")."/".$singleStaffImg))					{						rename($this->config->item("staffImageTempPath")."/".$singleStaffImg,$this->config->item("staffImagePath")."/".$singleStaffImg);					}				}				$dataImages = array(							'photo' => (($this->input->post("staff_hidden") && trim($this->input->post("staff_hidden"))!="")?trim($this->input->post("staff_hidden")):"none.jpg"),						);				$this->db->where('id',$adId);				$this->db->update($this->config->item('ala_goals','dbtables'), $dataImages);			}			return $res;		}	}		function deleteStaff($staffId)	{		$staffInfoQuery = $this->db->get_where($this->config->item('ala_goals','dbtables'),array("id"=>trim($staffId)));		$staffInfo = $staffInfoQuery->row();				$this->db->where('id', $staffId);		$res = $this->db->delete($this->config->item('ala_goals','dbtables')); 		if($res)		{			$staffPhotoArr = (($staffInfo && $staffInfo->photo!="")?explode("|", $staffInfo->photo):array());			foreach($staffPhotoArr as $singleStaffImg)			{				if(trim($singleStaffImg)!="")				{					@unlink($this->config->item("staffImagePath")."/".$singleStaffImg);				}			}		}		return $res;	}	}?>